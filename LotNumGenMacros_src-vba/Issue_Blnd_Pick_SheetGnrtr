Sub issueSheetGen()
'///Linked to F:F on  on Lot Number Generator sheet////////////////////////////////////////////////////////////////////////
'///Generates an issue sheet for the blend of the row that is clicked//////////////////////////////////////////////////////

    'Set the way back to the current workbook and turn off cell-selection-trigger macros
    Dim src As String
    src = ActiveWorkbook.Name
    Call MacrosOff

    'Declare array for blend info and populate it
    Dim blendInfo(6) As Variant
    blendInfo(0) = ActiveCell.Offset(0, -8).Value 'blend PN
    blendInfo(1) = ActiveCell.Offset(0, -7).Value 'blend Description
    blendInfo(2) = ActiveCell.Offset(0, -5).Value 'quantity
    blendInfo(3) = ActiveCell.Offset(0, 9).Value  'run date
        
    'Declare array for lot numbers and populate it
    Dim lotNumbers(9) As Variant
    lotNumbers(0) = ActiveCell.Offset(0, -6).Value
    Dim lotQuantities(9) As Variant
    lotQuantities(0) = ActiveCell.Offset(0, -5).Value
    ActiveCell.Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = -0.249977111117893
       .PatternTintAndShade = 0
    End With
    
    'for loop to set all the subsequent lot numbers
    Dim i As Integer
    i = 1
    For i = 1 To 9
        If blendInfo(0) = ActiveCell.Offset(-1, -8) Then
            If blendInfo(3) = ActiveCell.Offset(-1, 9) Then
                lotNumbers(i) = ActiveCell.Offset(-1, -6)
                lotQuantities(i) = ActiveCell.Offset(-1, -5)
                ActiveCell.Offset(-1, 0).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.249977111117893
                   .PatternTintAndShade = 0
                End With
                Selection.Activate
            End If
        End If
    Next i
    
    'Store the line value in array too
    Select Case ActiveCell.Offset(0, 8).Value
    Case "Hx"
        blendInfo(4) = "Horix"
    Case "Dm"
        blendInfo(4) = "Drums"
    Case "Prod"
        blendInfo(4) = ""
    Case "Totes"
        blendInfo(4) = "Totes"
    Case "Pails"
        blendInfo(4) = "Pails"
    End Select

    'Open the blend issue sheet
    Workbooks.Open Filename:= _
        "G:\Blending\02 Blending Issue Sheet\NOT_Blending_Issue_Sheet.xlsb"

    With ActiveWorkbook
        'blend information
        Range("B8").Value = blendInfo(0) 'plug in blend PN
        Range("D8").Value = blendInfo(1) 'plug in blend Description
        Range("B12").Value = blendInfo(2) 'plug in quantity
        Range("D4").Value = blendInfo(3) 'plug in run date
        Range("D6").Value = blendInfo(4) 'plug in line name
        'lot numbers and quantities
        Range("B10").Value = lotNumbers(0)
        Range("B12").Value = lotQuantities(0)
        Range("D10").Value = lotNumbers(1)
        Range("D12").Value = lotQuantities(1)
        Range("F10").Value = lotNumbers(2)
        Range("F12").Value = lotQuantities(2)
        Range("B24").Value = lotNumbers(3)
        Range("B26").Value = lotQuantities(3)
        Range("D24").Value = lotNumbers(4)
        Range("D26").Value = lotQuantities(4)
        Range("F24").Value = lotNumbers(5)
        Range("F26").Value = lotQuantities(5)
        Range("B29").Value = lotNumbers(6)
        Range("B31").Value = lotQuantities(6)
        Range("D29").Value = lotNumbers(7)
        Range("D31").Value = lotQuantities(7)
        Range("F29").Value = lotNumbers(8)
        Range("F31").Value = lotQuantities(8)
    End With
    
    Call MacrosOn
 
    'Return to issue sheet
    Windows("NOT_Blending_Issue_Sheet.xlsb").Activate
     
End Sub


Sub blndSheetGen()
'///Assigned to the green column to the right of the list of lot numbers.//////////////////////////////////////////////////
'///Opens the blend sheet workbook for the blend on the row you click. Inputs the qty into said blend sheet.///////////////

On Error GoTo JustInCase
    
    Call MacrosOff
    
    'String for current workbook name
    Dim src As String
    src = ActiveWorkbook.Name
    
    Dim blendInfo(5) As Variant
    'Copy the value of the shortage qty cell
    blendInfo(0) = ActiveCell.Value         'qty
    blendInfo(1) = ActiveCell.Offset(0, -8) 'lot number
    blendInfo(2) = ActiveCell.Offset(0, 6)  'line
    blendInfo(3) = ActiveCell.Offset(0, -9) 'blend desc
    blendInfo(4) = ActiveCell.Offset(0, 7)  'run date
    
    'Get the filepath + name of the appropriate blend sheet and set formula calc to Automatic
    Dim blndShtPath As String
    blndShtPath = ActiveCell.Offset(0, 1).Value
    Workbooks.Open Filename:= _
        blndShtPath
    Application.Calculation = xlAutomatic

    'Put the lot qty and lot num into the sheet and print
    Cells.Find(What:="Theory Gallons", After:=ActiveCell, LookIn:=xlFormulas2 _
        , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
        MatchCase:=False, SearchFormat:=False).Activate
    ActiveCell.Offset(1, 0).Value = blendInfo(0)
    Cells.Find(What:="Lot Number:", After:=ActiveCell, LookIn:=xlFormulas2 _
        , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
        MatchCase:=False, SearchFormat:=False).Activate
    ActiveCell.Offset(0, 1).Value = blendInfo(1)
    ActiveSheet.PrintOut
    
    'Set a variable so we can return to this regardless of filename
    Dim blndSht As String
    blndSht = ActiveWorkbook.Name

    'Fill blend sheet button gray
    Windows(src).Activate
    ActiveCell.Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = -0.249977111117893
       .PatternTintAndShade = 0
    End With
    
    Dim i As Integer
    i = 1
    Select Case blendInfo(2)
        Case "Hx", "Dm", "Totes", "Pails"
            For i = 1 To 18
                Windows(src).Activate
                'fill cell gray
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.249977111117893
                    .PatternTintAndShade = 0
                End With
                If blendInfo(3) = ActiveCell.Offset(-1, -9) Then
                    If blendInfo(4) = ActiveCell.Offset(-1, 7) Then
                        Dim moreInfo(4) As Variant 'another array to hold info for next line up
                        ActiveCell.Offset(-1, 0).Select 'hit up the next line if the blend desc's match
                        Selection.Activate
                        moreInfo(0) = ActiveCell.Value         'qty
                        moreInfo(1) = ActiveCell.Offset(0, -8) 'lot number
                        moreInfo(2) = ActiveCell.Offset(0, 6)  'line
                        moreInfo(3) = ActiveCell.Offset(0, -9) 'blend desc
                        Windows(blndSht).Activate
                        'Put the lot qty and lot num into the sheet and print
                        Cells.Find(What:="Theory Gallons", After:=ActiveCell, LookIn:=xlFormulas2 _
                            , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
                            MatchCase:=False, SearchFormat:=False).Activate
                        ActiveCell.Offset(1, 0).Value = moreInfo(0) 'qty
                        Cells.Find(What:="Lot Number:", After:=ActiveCell, LookIn:=xlFormulas2 _
                            , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
                            MatchCase:=False, SearchFormat:=False).Activate
                        ActiveCell.Offset(0, 1).Value = moreInfo(1) 'lot no
                        ActiveSheet.PrintOut
                    End If
                End If
            Next i
            Windows(blndSht).Close SaveChanges:=False
        Case "Prod"
            'Return to blend sheet workbook clear the lot number cell
            Windows(blndSht).Activate
            Cells.Find(What:="Lot Number:", After:=ActiveCell, LookIn:=xlFormulas2 _
                , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
                MatchCase:=False, SearchFormat:=False).Activate
            ActiveCell.Offset(0, 1).Value = ""
            Windows(blndSht).Close SaveChanges:=False
    End Select
    
    Windows(src).Activate
    Call MacrosOn
    
Done: Exit Sub

JustInCase:
    Dim uInput As Integer
    uInput = MsgBox("Couldn't find this blend sheet--open folder to look for it manually?", vbQuestion + vbYesNo)

    If uInput = vbYes Then
        'Get the filepath of the blend sheet folder
        Dim sheetsFolderPath As String
        sheetsFolderPath = ActiveWorkbook.Sheets(2).Range("A2").Value
        Call Shell("explorer.exe " & sheetsFolderPath)
        'Application.SendKeys ("%{TAB}"), True
    Else
        MsgBox "Ok"
    End If

End Sub

Sub pickSheetGen()
'///Assigned to K:K to the right of the list of lot nums///////////////////////////////////////////////////////////////////
'///Opens the blend schedule filters ChemsToCheck to the requirements of the blend in question/////////////////////////////

    'MacrosOff
    Call MacrosOff

    'Set the way back to the current workbook
    Dim src As String
    src = ActiveWorkbook.Name
    Dim lotInfo(3) As Variant
    lotInfo(0) = ActiveCell.Offset(0, -12)
    lotInfo(1) = ActiveCell.Offset(0, -11)
    lotInfo(2) = ActiveCell.Offset(0, -10)

    'Open the blending schedule
    Workbooks.Open Filename:= _
        "C:\OD\Kinpak, Inc\Blending - Documents\03 Projects\Blending Schedule\Blending-Schedule\Blending Schedule_1.3.xlsb"

    'Go to blend schedule and filter [BlendPN] by the PN copied from Lot Number Gen
    Worksheets("pickSheetTable").Visible = True
    Worksheets("pickSheetTable").Activate
    ActiveSheet.ListObjects("pickSheetTable_query").Range.AutoFilter Field:=1, Criteria1:= _
            lotInfo(0)

    'Hide columns
    Range("A:B").Select
    Selection.EntireColumn.Hidden = True
        
    'Insert row, write in Date and Time fields
    Rows("1:1").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("C1").Select
    ActiveCell.FormulaR1C1 = "Required chemicals for " & lotInfo(0) + " " + lotInfo(1) + ", Lot " + lotInfo(2)
    Range("C2").Select
    ActiveCell.FormulaR1C1 = "Date: " & Now()
   
    'format the stuff
    Range("C1:C2").Select
    With Selection.Font
        .Name = "Calibri"
        .Size = 18
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ThemeColor = xlThemeColorLight1
        .TintAndShade = 0
        .ThemeFont = xlThemeFontMinor
    End With
    Selection.HorizontalAlignment = xlLeft
    
    ActiveSheet.PrintOut

    'Clear filter
    Call clearChemsToCheckFilter1
   
    'Show columns again
    Range("A:B").Select
    Selection.EntireColumn.Hidden = False
    
    Worksheets("pickSheetTable").Visible = False
    Sheets("BlendThese").Activate

    'MacrosOn in Lot Number Gen
    Windows(src).Activate
    ActiveCell.Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = -0.249977111117893
       .PatternTintAndShade = 0
    End With
    
    Call MacrosOn
    
End Sub