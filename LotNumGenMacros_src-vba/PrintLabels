Public Declare PtrSafe Function GetTickCount Lib "kernel32.dll" () As Long

Sub Delay(Finish As Long)
    Dim NowTick As Long
    Dim EndTick As Long
    
    EndTick = GetTickCount + (Finish * 1000)
    
    Do
        NowTick = GetTickCount
        DoEvents
    
    Loop Until NowTick >= EndTick
End Sub



Sub labelPrinter()
'///Prints labels for the row selected/////////////////////////////////////////////////////////////////////////////////////
'///Assigned to row M:M////////////////////////////////////////////////////////////////////////////////////////////////////

    Dim protecc As String
    Dim labelPath As String
    Dim labelCount As Integer
    Dim labelInfo(4) As Variant

    'macros off
    Call MacrosOff

    'select the correct filepath for the barTender document based on which protections are needed
    labelPath = "C:\OD\Kinpak, Inc\Blending - Documents\01 Spreadsheet Tools\Blending Label Templates & BTdatabases\BlendInventoryLabels\"
    protecc = ActiveCell.Offset(0, -1).Value
    labelPath = labelPath & protecc & ".btw"

    'number of labels to be made
    labelCount = ActiveCell.Value

    'Set values into array slots
    labelInfo(0) = ActiveCell.Offset(0, 1).Value   'shortname
    labelInfo(1) = ActiveCell.Offset(0, -1).Value  'protection type
    labelInfo(2) = ActiveCell.Offset(0, -12).Value 'lot number
    labelInfo(3) = ActiveCell.Offset(0, -14).Value 'blend PN

    'Put everything over there in the workbook that feeds the barTender templates
    Workbooks.Open "C:\OD\Kinpak, Inc\Blending - Documents\01 Spreadsheet Tools\Blending Label Templates & BTdatabases\BlendInventoryLabels\LabelGenLayover.xlsx"
    Range("A2").Value = labelInfo(3)
    Range("B2").Value = labelInfo(0)
    Range("C2").Value = labelInfo(2)
    Range("D2").Value = labelInfo(1)

    'save & close so barTender can access the spreadsheet
    Workbooks("LabelGenLayover.xlsx").Close SaveChanges:=True

    'go back to blend lot num generator workbook and determine label qty
    Workbooks("Blending Lot Number Generator.xlsb").Activate
    
    Dim answer As Integer
    answer = MsgBox("Print the pre-calculated number of labels for this lot?", vbQuestion + vbYesNo + vbDefaultButton2, "Label Quantity")
           
    If answer = vbYes Then
        ActiveWorkbook.FollowHyperlink Address:=labelPath, NewWindow:=True
        Delay (2)
        Application.SendKeys "^p", True
        Application.SendKeys labelCount, True
        Application.SendKeys "{Enter}", True
        Delay (1)
        Application.SendKeys "%{TAB}", True
    Else
        Dim userInputCount As Integer
        userInputCount = InputBox("How many labels?", "Labels", 1)
        ActiveWorkbook.FollowHyperlink Address:=labelPath, NewWindow:=True
        Delay (2)
        Application.SendKeys "^p", True
        Application.SendKeys userInputCount, True
        Application.SendKeys "{Enter}", True
        Delay (1)
        Application.SendKeys "%{TAB}", True
    End If
    
    'color cell gray
    Workbooks("Blending Lot Number Generator.xlsb").Activate
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = -0.249977111117893
       .PatternTintAndShade = 0
    End With
    
    'macros on
    Call MacrosOn
    
    'turn NumLock back on
    ToggleNumlock True
    
    Windows("Blending Lot Number Generator.xlsb").Activate
    
End Sub